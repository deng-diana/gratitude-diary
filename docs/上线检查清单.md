# 📦 上线前检查清单

## ⚠️ 重要提醒：打包上线前必须完成以下步骤！

### 1. 切换后端API地址到生产环境

**文件位置：** `mobile/src/config/aws-config.ts`

**需要修改：**
```typescript
// 🔄 环境切换：true = 本地开发，false = 生产环境
const IS_LOCAL_DEV = false;  // ⚠️ 上线前改为 false
```

**检查点：**
- [ ] `IS_LOCAL_DEV` 已设置为 `false`
- [ ] 确认 `API_BASE_URL` 指向生产环境 URL
- [ ] 测试生产环境 API 连接正常

---

### 2. 检查 Cognito 配置

**文件位置：** `mobile/src/config/aws-config.ts`

**检查点：**
- [ ] `userPoolId` 正确
- [ ] `userPoolWebClientId` 正确
- [ ] `oauth.domain` 正确（生产环境域名）
- [ ] `redirectSignIn` 和 `redirectSignOut` 使用生产环境 scheme（`myapp://`）

---

### 3. 关闭开发模式开关

**文件位置：** `mobile/src/navigation/AppNavigator.tsx`

**检查点：**
- [ ] `DEV_MODE_FORCE_ONBOARDING` 已设置为 `false`
- [ ] 移除所有调试日志和测试代码

---

### 4. 环境变量和敏感信息

**检查点：**
- [ ] 确认没有硬编码的测试凭据
- [ ] 所有敏感信息都通过环境变量或配置文件管理
- [ ] `.env` 文件已添加到 `.gitignore`

---

### 5. 构建配置检查

**iOS (app.json):**
- [ ] `bundleIdentifier` 正确
- [ ] App 图标和启动画面已更新
- [ ] 版本号已更新

**Android (app.json):**
- [ ] `package` 正确
- [ ] App 图标和启动画面已更新
- [ ] 版本号已更新

---

### 6. 功能测试

**测试清单：**
- [ ] 用户注册/登录流程
- [ ] 日记创建、编辑、删除
- [ ] 语音录制和转文字
- [ ] 数据同步到云端
- [ ] 离线功能（如果有）

---

### 7. 性能优化

**检查点：**
- [ ] 移除不必要的 console.log
- [ ] 优化图片资源大小
- [ ] 检查网络请求频率
- [ ] 确认错误处理完善

---

### 8. 安全检查

**检查点：**
- [ ] API 密钥不会暴露在前端代码中
- [ ] HTTPS 连接正常
- [ ] Token 存储安全（使用 SecureStore）
- [ ] 输入验证和错误处理完善

---

## 📝 快速切换脚本

在 `mobile/src/config/aws-config.ts` 中：

```typescript
// 🚀 上线前：将这行改为 false
const IS_LOCAL_DEV = false;  // ⚠️ 上线前必须改为 false
```

---

## ✅ 最终验证

打包前最后一次检查：
1. 运行 `expo build:ios` 或 `expo build:android` 前
2. 确认控制台输出显示：`🔗 API地址: https://... (生产环境)`
3. 不要看到任何 `localhost` 或 `192.168.x.x` 的地址

---

**创建日期：** 2025-01-XX  
**最后更新：** 2025-01-XX

